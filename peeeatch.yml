---
- hosts: 192.168.99.131
  tasks:
    - name: Download the patch
      get_url:
        url: https://www.openssl.org/source/openssl-1.0.2h.tar.gz
        dest: /tmp

    - name: Extract the patch
      unarchive:
        src: /tmp/openssl-1.0.2h.tar.gz
        dest: /tmp
        remote_src: yes

    # - name: Install the patch
    #   command: 
    #     cmd: ./config && make && make test && make install
    #     chdir: /tmp/openssl-1.0.2h/
    #     creates: /usr/local/ssl/bin/openssl

    - name: CD 
      command: cd /tmp/openssl-1.0.2h/

    - name: Configure and build OpenSSL  
      shell: ./config  
      register: result1  
      
    - name: Build OpenSSL  
      shell: make  
      register: result2  
      when: result1.rc == 0  
      
    - name: Test OpenSSL  
      shell: make test  
      register: result3  
      when: result2.rc == 0  
      
    - name: Install OpenSSL  
      shell: make install  
      register: result4  
      when: result3.rc == 0  

    - name: Verify installation
      command: openssl version
      register: result

    - debug:
        var: result.stdout_lines
